<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Student Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        input {
            padding: 6px;
            margin-right: 10px;
        }
        button {
            padding: 6px 12px;
            margin: 2px;
            cursor: pointer;
            border: none;
        }
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        .update-btn {
            background-color: #3498db;
            color: white;
        }
        .search-btn {
            background-color: #2ecc71;
            color: white;
        }
        .insert-btn {
            background-color: #f39c12;
            color: white;
        }
        .controls {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<h2>Student Manager</h2>

<div class="controls">
    <input type="text" id="nameInput" placeholder="Name" />
    <input type="text" id="surnameInput" placeholder="Surname" />
    <input type="text" id="emailInput" placeholder="Email" />
    <input type="number" id="ageInput" placeholder="Age" />
    <input type="text" id="universityInput" placeholder="University" />
    <button class="search-btn" onclick="searchByName()">Search</button>
    <button class="insert-btn" onclick="insertStudent()">Insert</button>
</div>

<table id="studentTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Surname</th>
        <th>Email</th>
        <th>Age</th>
        <th>University</th>
        <th>Operation</th>
    </tr>
    </thead>
    <tbody id="studentBody">
    <!-- Student rows will be inserted here -->
    </tbody>
</table>

<script>
    const API_URL = 'http://localhost:8081/students';

    document.addEventListener('DOMContentLoaded', fetchAll);

    function fetchAll() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => renderStudents(data))
            .catch(err => console.error('Fetch all error:', err));
    }

    function renderStudents(students) {
        const tbody = document.getElementById('studentBody');
        tbody.innerHTML = '';
        students.forEach(student => {
            const row = document.createElement('tr');
            row.setAttribute('data-id', student.id);
            row.innerHTML = `
                <td>${student.id}</td>
                <td contenteditable="true">${student.name}</td>
                <td contenteditable="true">${student.surname}</td>
                <td contenteditable="true">${student.email}</td>
                <td contenteditable="true">${student.age}</td>
                <td contenteditable="true">${student.university}</td>
                <td>
                    <button class="delete-btn" onclick="deleteStudent(${student.id})">Delete</button>
                    <button class="update-btn" onclick="updateStudent(${student.id})">Update</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function searchByName() {
        const name = document.getElementById('nameInput').value;
        if (!name.trim()) {
            fetchAll();
            return;
        }
        fetch(`${API_URL}/search?name=${encodeURIComponent(name)}`)
            .then(res => res.json())
            .then(data => renderStudents(data))
            .catch(err => console.error('Search error:', err));
    }

    function insertStudent() {
        const name = document.getElementById('nameInput').value;
        const surname = document.getElementById('surnameInput').value;
        const email = document.getElementById('emailInput').value;
        const age = parseInt(document.getElementById('ageInput').value);
        const university = document.getElementById('universityInput').value;

        if (!name || !surname || !email || isNaN(age) || !university) {
            alert('Please fill in all fields.');
            return;
        }

        const payload = { name, surname, email, age, university };

        fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
            .then(res => res.json())
            .then(() => {
                alert('Student inserted');
                clearInputs();
                fetchAll();
            })
            .catch(err => console.error('Insert error:', err));
    }

    function deleteStudent(id) {
        fetch(`${API_URL}/${id}`, {
            method: 'DELETE'
        })
            .then(() => {
                alert('Student deleted');
                fetchAll();
            })
            .catch(err => console.error('Delete error:', err));
    }

    function updateStudent(id) {
        const row = document.querySelector(`tr[data-id='${id}']`);
        const cells = row.querySelectorAll('td');

        const payload = {
            name: cells[1].innerText.trim(),
            surname: cells[2].innerText.trim(),
            email: cells[3].innerText.trim(),
            age: parseInt(cells[4].innerText.trim()),
            university: cells[5].innerText.trim()
        };

        fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
            .then(() => {
                alert('Student updated');
                fetchAll();
            })
            .catch(err => console.error('Update error:', err));
    }

    function clearInputs() {
        document.getElementById('nameInput').value = '';
        document.getElementById('surnameInput').value = '';
        document.getElementById('emailInput').value = '';
        document.getElementById('ageInput').value = '';
        document.getElementById('universityInput').value = '';
    }
</script>

</body>
</html>
